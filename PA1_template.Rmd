---
title: "First_Knitr"
author: "EHarris"
date: "5/25/2017"
output: html_document
---

## Set Global Option
```{r setoptions, echo = FALSE}
opts_chunk$set(echo = FALSE, results = asis, include = TRUE)
```

## Load anticipated packages to be used throughout Course 5 Project 1
```{r setup, include=TRUE}
ipak <- function(pkg){
      new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
      if (length(new.pkg)) 
            install.packages(new.pkg, dependencies = TRUE)
      sapply(pkg, require, character.only = TRUE)
}

### Package Usage
packages <- c("plyr", "dplyr", "data.table", "dtplyr", "lubridate", "ggplot2", "knitr")
ipak(packages)
```

## Item 1: Code for reading in the dataset and/or processing the data
###   Step 1: Read csv file into R
```{r fileload, include = TRUE}
activity <- read.csv("activity.csv", header = TRUE)
```

###   Step 2: Process data to address other parts of assignment
```{r iniital_processing, include = TRUE}
activity$date <- as.Date(activity$date, format = "%Y-%m-%d")
activity$day <- weekdays(activity$date)
activity$daytype <- ifelse(activity$day %in% c("Saturday", "Sunday"), "Weekend", "Weekday")
activity$date1 <- format(activity$date1, format = "%Y%m%d")
activity$date2 <- format(activity$date1, format = "%Y%b%d")
activity$day_int <- paste(activity$day, activity$interval, sep = "_")
activity <- select(activity, daytype, day, date, date1, date2, interval,
                              day_int, steps)
activity <- activity[order(activity$date, activity$interval),]
dates <- as.data.frame(unique(activity$date))
colnames(dates)[1] <- "date"
minDate <- as.Date(min(dates$date))
maxDate <- as.Date(max(dates$date))
daterange <- c(seq(from = minDate, to = maxDate, by = 3))
```

## Item 2. Histogram of the total number of steps taken each day.  Two steps:  
### Step 1: Calculate total steps each day  
```{r total_steps_per_day, include = TRUE}
steps.a.day <- aggregate(steps ~ date, data = activity, FUN = function(x) sum=sum(x))
steps.a.day$steps1000 <- round(steps.a.day$steps/1000, digits = 2)
```

### Step 2: Plot histogram reflecting total number of steps by day
```{r steps_per_dzy_hist, fig.keep = "all"", fig.show = "asis" }
hist(steps.a.day$steps1000, breaks = round(length(dates$date)/3, digits = 0),
            xlab = "Dates", ylab = "Total Steps (000s)",
            main = "Total Steps Each Day", ylim = c(0, 25),
            xlim = range(daterange), ylim = c(0, 25),
            axes = TRUE, plot = TRUE, freq = FALSE, right = TRUE,
            strptime(steps.a.day$date, format = "%Y-%m-%d", tz = ""))
qplot(steps.a.day$steps1000, geom = "histogram", binwidth = 0.2, xlab = "Date",
                  ylab = "Total Steps (000s)", xlim = as.Date(daterange), ylim = c(0,25))
ggplot(data = steps.a.day, aes(steps.a.day1$date)) +
            geom_histogram(breaks = seq(mindate, maxdate, by = 6) +
            labs(title = "Total Steps Each Day") +
            labs(x = "Date", y = "Total Steps(000s)") +
            xlim(as.Date(c(mindate, maxdate))) +
            ylim(c(0, 25)))


with(steps.a.day1, plot(date1, steps, main = "Total Steps Each Day", type = "n"))
```

## Item 3: Mean & Median steps per day [Days with no steps are excluded]
```{r mean_median_steps_per_day, include = TRUE}
meansteps <- mean(steps.a.day$steps, na.rm = TRUE)
mediansteps <- median(steps.a.day$steps, na.rm = TRUE)
steps.a.day1 <- data.frame("Mean Steps" = meansteps, "Median Steps" = mediansteps)
steps.a.day1
```

## Item 4: Time series (day of week) plot of the average number of steps taken
```{r mean_steps_day_of_week, include = TRUE}
mean.steps.day <- aggregate(steps ~ day, data = activity, 
                                    FUN = function(x) mean=mean(x))
qplot(day, steps, data = mean.steps.day, pch = 20, geom = c("point", "smooth"),
      xlim = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday","Saturday", "Sunday"),
      xlab = "Day of Week", ylab = "Average Number of Steps",
      main = "Average Steps per Day of Week")
```

## Item 5: 5-munite interval with maximum average number of steps
```{r mean_steps_each5, include = TRUE}
steps.each.5min <- aggregate(steps ~ interval, data = activity,
                                    FUN = function(x) meansteps=mean(x))
steps.each.5min <- steps.each.5min[order(steps.each.5min$steps, decreasing = TRUE),]
steps.each.5min[1,]
```

## Item 6: Code to describe and show a strategy for imputing missing data
```
To impute a value that best reflects a missign value there are two parameters  
to be considered: 1) day of week and 2) interval.  We will replace each  
missing value with applicable imputed value.  
```
### Step 1: Calculate the mean steps for each day of week + interval combination  
```{r mean_steps_day_interval, include = TRUE}
mean.day.interval <- aggregate(steps ~ day + interval, data = activity,
                                    FUN = function(x) mean=round(mean(x), digits = 0))
mean.day.interval$day_int <- paste(mean.day.interval$day, mean.day.interval$interval,
                                    sep = "_")
mean.day.interval <- select(day, interval, day_int, steps)
```

### Step 2: Identify missing values then replace with the imputed value.  
```
This, too, is completed in multiple steps.  The first step is to subset  
the missing values from observations with values.  A second step is to replace  
missing values with imputed values.  The final step is to combine the data  
sets with imputed values to those observations with actula values.  
```

#### Step 2a: Create data subsets, missing values and non-missing values
```{r subset_missing, include = TRUE}
activity.isna <- subset(activity, is.na(steps))
activity.isna <- select(activity.isna, daytype, day, date, date1, date2,
                              interval, day_int)
activity.clean <- subset(activity, !is.na(steps))
```

#### Step 2b: Replace missign values with imputed values (merge function)
```{r subset_replace_missing, include = TRUE}
activity.impute <- merge(activity.isna, mean.day.interval, by = day_int, all = FALSE)
```

#### Step 2c: Combine, rbind(), imputed observations with actual observations
```{r combine_impute_actual, include = TRUE}
activity.total <- rbind(activity.clean, activity.impute)
activity.total <- activity.total[order(activity.total[,3], activity.total[,6]),]
```

## Item 7: Histogram of total steps each day after missing values are imputed
```
This is done in two steps.  The first step is simply calculating the total  
number of steps for each day.  The second, and final, step is creating a  
histogram of the number of steps for each day.  
```

### Step 1: Calculate total number of steps for each day, including imputed
```{r total_steps_with_imputed, include = TRUE}
impute.total.steps <- aggregate(steps ~ date, data = activity.total,
                             FUN = function(x) sum = sum(x))
impute.total.steps$steps1000 <- round(steps.a.day1$steps/1000, digits = 2)
```

### Item 8: Panel plot of average number of steps per 5-minute interval  
#### A comparison of weekdays and weekend
```{r panel_plot, include = TRUE}
mean.steps.daytype <- aggregate(steps ~ daytype + interval, data = activity,
                             FUN = function(x) mean=mean(x))
mean.wday <- subset(mean.steps.daytype, daytype == "Weekday")
mean.wend <- subset(mean.steps.daytype, daytype == "Weekend")
min.yrange <- round(min(mean.steps.daytype$steps),0)
max.yrange <- round(max(mean.steps.daytype$steps),0)
yrange <- range(seq(from = min.yrange, to = max.yrange, by = 50))
par(mfrow = c(1, 2), mar = c(4, 4, 2, 1), oma = c(0, 0, 2, 0))
plot(mean.wday$interval, mean.wday$steps, pch = 20, type = "l",
                        xlim = range(0,2500), ylim = yrange, xlab = "", 
                        ylab = "Average Number of Steps", main = "Weekday")
plot(mean.wend$interval, mean.wend$steps, pch = 20, type = "l",
                        xlim = range(0,2500), ylim = yrange, xlab = "",
                        ylab = "", main = "Weekend")
```
